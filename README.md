# Metadata Summary Fetcher

DT4H **toolbox component** returning the summary metadata file associated to AI-ready tabular dataset generated by **onFeast** REST API.

When integrated at the DataTools4Heart platform as one of the federated tools operated by the **central federated manager** (FEM), the *Metadata Summary Fetcher* acts effectively as a middleware able to access the onFHIR services, only exposed locally on the federated data nodes (FDN). The fetcher does a localhost HTTP query to the **onFeast** REST endpoint, who returns the summary metadata JSON file of a given dataset id.

## Pre-conditions
The *Metadata Summary Fetcher* is mean to interact with other components of DT4H platform:
- **onFHIR REST endpoint/s** (one or more), generating and returning the summary metadata file
- **central federated manager (FEM)**, executing the tool on the FDNs and setting up its parameters 

## Build and install
The tool is implemented as a docker container. You can either:
- Pull the image from the DT4H docker registry
```
TOKEN=<token>
echo "$TOKEN" | docker login registry.gitlab.bsc.es -u <username> --password-stdin
docker pull https://gitlab.bsc.es/fl/dt4h_summary_materializer
```
- Build the image from the Dockerfile
```
git clone https://github.com/DataTools4Heart/onFHIR_metadata_fetcher
docker build --tag onFHIR_metadata_fetcher:v1.0 . 
```
## Usage

Configure the following parameters to build the appropiate `docker run` command. 

Environemt variables:
- `FILE_ID`: dataset identifier
- `EXECUTION_DIR`:  Working directory within the FDN sandbox where the outcomes of the tool execution (logs, tool outfiles, etc.) are going to be generated
- `NODE_NAME`: Name of the federated data node (FDN)
- `GET_URL_[NODE_NAME]`: URL onFeast API endpoint generating the summary metadata file

Data volumes:
- `EXECUTION_DIR`

